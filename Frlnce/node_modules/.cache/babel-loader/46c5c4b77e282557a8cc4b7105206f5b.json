{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.RangeObject = void 0;\nexports.blob2base64 = blob2base64;\nexports.borders = borders;\nexports.bounds = bounds;\nexports.createBase64Url = createBase64Url;\nexports.createBlob = createBlob;\nexports.createBlobUrl = createBlobUrl;\nexports.defaults = defaults;\nexports.defer = defer;\nexports.documentHeight = documentHeight;\nexports.extend = extend;\nexports.filterChildren = filterChildren;\nexports.findChildren = findChildren;\nexports.getParentByTagName = getParentByTagName;\nexports.indexOfElementNode = indexOfElementNode;\nexports.indexOfNode = indexOfNode;\nexports.indexOfSorted = indexOfSorted;\nexports.indexOfTextNode = indexOfTextNode;\nexports.insert = insert;\nexports.isElement = isElement;\nexports.isFloat = isFloat;\nexports.isNumber = isNumber;\nexports.isXml = isXml;\nexports.locationOf = locationOf;\nexports.nodeBounds = nodeBounds;\nexports.parents = parents;\nexports.parse = parse;\nexports.prefixed = prefixed;\nexports.qs = qs;\nexports.qsa = qsa;\nexports.qsp = qsp;\nexports.querySelectorByType = querySelectorByType;\nexports.requestAnimationFrame = void 0;\nexports.revokeBlobUrl = revokeBlobUrl;\nexports.sprint = sprint;\nexports.treeWalker = treeWalker;\nexports.type = type;\nexports.uuid = uuid;\nexports.walk = walk;\nexports.windowBounds = windowBounds;\n\nvar _xmldom = require(\"@xmldom/xmldom\");\n/**\n * Core Utilities and Helpers\n * @module Core\n*/\n\n/**\n * Vendor prefixed requestAnimationFrame\n * @returns {function} requestAnimationFrame\n * @memberof Core\n */\n\n\nconst requestAnimationFrame = typeof window != \"undefined\" ? window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame : false;\nexports.requestAnimationFrame = requestAnimationFrame;\nconst ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\nconst COMMENT_NODE = 8;\nconst DOCUMENT_NODE = 9;\n\nconst _URL = typeof URL != \"undefined\" ? URL : typeof window != \"undefined\" ? window.URL || window.webkitURL || window.mozURL : undefined;\n/**\n * Generates a UUID\n * based on: http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\n * @returns {string} uuid\n * @memberof Core\n */\n\n\nfunction uuid() {\n  var d = new Date().getTime();\n  var uuid = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (c) {\n    var r = (d + Math.random() * 16) % 16 | 0;\n    d = Math.floor(d / 16);\n    return (c == \"x\" ? r : r & 0x7 | 0x8).toString(16);\n  });\n  return uuid;\n}\n/**\n * Gets the height of a document\n * @returns {number} height\n * @memberof Core\n */\n\n\nfunction documentHeight() {\n  return Math.max(document.documentElement.clientHeight, document.body.scrollHeight, document.documentElement.scrollHeight, document.body.offsetHeight, document.documentElement.offsetHeight);\n}\n/**\n * Checks if a node is an element\n * @param {object} obj\n * @returns {boolean}\n * @memberof Core\n */\n\n\nfunction isElement(obj) {\n  return !!(obj && obj.nodeType == 1);\n}\n/**\n * @param {any} n\n * @returns {boolean}\n * @memberof Core\n */\n\n\nfunction isNumber(n) {\n  return !isNaN(parseFloat(n)) && isFinite(n);\n}\n/**\n * @param {any} n\n * @returns {boolean}\n * @memberof Core\n */\n\n\nfunction isFloat(n) {\n  let f = parseFloat(n);\n\n  if (isNumber(n) === false) {\n    return false;\n  }\n\n  if (typeof n === \"string\" && n.indexOf(\".\") > -1) {\n    return true;\n  }\n\n  return Math.floor(f) !== f;\n}\n/**\n * Get a prefixed css property\n * @param {string} unprefixed\n * @returns {string}\n * @memberof Core\n */\n\n\nfunction prefixed(unprefixed) {\n  var vendors = [\"Webkit\", \"webkit\", \"Moz\", \"O\", \"ms\"];\n  var prefixes = [\"-webkit-\", \"-webkit-\", \"-moz-\", \"-o-\", \"-ms-\"];\n  var lower = unprefixed.toLowerCase();\n  var length = vendors.length;\n\n  if (typeof document === \"undefined\" || typeof document.body.style[lower] != \"undefined\") {\n    return unprefixed;\n  }\n\n  for (var i = 0; i < length; i++) {\n    if (typeof document.body.style[prefixes[i] + lower] != \"undefined\") {\n      return prefixes[i] + lower;\n    }\n  }\n\n  return unprefixed;\n}\n/**\n * Apply defaults to an object\n * @param {object} obj\n * @returns {object}\n * @memberof Core\n */\n\n\nfunction defaults(obj) {\n  for (var i = 1, length = arguments.length; i < length; i++) {\n    var source = arguments[i];\n\n    for (var prop in source) {\n      if (obj[prop] === void 0) obj[prop] = source[prop];\n    }\n  }\n\n  return obj;\n}\n/**\n * Extend properties of an object\n * @param {object} target\n * @returns {object}\n * @memberof Core\n */\n\n\nfunction extend(target) {\n  var sources = [].slice.call(arguments, 1);\n  sources.forEach(function (source) {\n    if (!source) return;\n    Object.getOwnPropertyNames(source).forEach(function (propName) {\n      Object.defineProperty(target, propName, Object.getOwnPropertyDescriptor(source, propName));\n    });\n  });\n  return target;\n}\n/**\n * Fast quicksort insert for sorted array -- based on:\n *  http://stackoverflow.com/questions/1344500/efficient-way-to-insert-a-number-into-a-sorted-array-of-numbers\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @returns {number} location (in array)\n * @memberof Core\n */\n\n\nfunction insert(item, array, compareFunction) {\n  var location = locationOf(item, array, compareFunction);\n  array.splice(location, 0, item);\n  return location;\n}\n/**\n * Finds where something would fit into a sorted array\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @param {function} [_start]\n * @param {function} [_end]\n * @returns {number} location (in array)\n * @memberof Core\n */\n\n\nfunction locationOf(item, array, compareFunction, _start, _end) {\n  var start = _start || 0;\n  var end = _end || array.length;\n  var pivot = parseInt(start + (end - start) / 2);\n  var compared;\n\n  if (!compareFunction) {\n    compareFunction = function (a, b) {\n      if (a > b) return 1;\n      if (a < b) return -1;\n      if (a == b) return 0;\n    };\n  }\n\n  if (end - start <= 0) {\n    return pivot;\n  }\n\n  compared = compareFunction(array[pivot], item);\n\n  if (end - start === 1) {\n    return compared >= 0 ? pivot : pivot + 1;\n  }\n\n  if (compared === 0) {\n    return pivot;\n  }\n\n  if (compared === -1) {\n    return locationOf(item, array, compareFunction, pivot, end);\n  } else {\n    return locationOf(item, array, compareFunction, start, pivot);\n  }\n}\n/**\n * Finds index of something in a sorted array\n * Returns -1 if not found\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @param {function} [_start]\n * @param {function} [_end]\n * @returns {number} index (in array) or -1\n * @memberof Core\n */\n\n\nfunction indexOfSorted(item, array, compareFunction, _start, _end) {\n  var start = _start || 0;\n  var end = _end || array.length;\n  var pivot = parseInt(start + (end - start) / 2);\n  var compared;\n\n  if (!compareFunction) {\n    compareFunction = function (a, b) {\n      if (a > b) return 1;\n      if (a < b) return -1;\n      if (a == b) return 0;\n    };\n  }\n\n  if (end - start <= 0) {\n    return -1; // Not found\n  }\n\n  compared = compareFunction(array[pivot], item);\n\n  if (end - start === 1) {\n    return compared === 0 ? pivot : -1;\n  }\n\n  if (compared === 0) {\n    return pivot; // Found\n  }\n\n  if (compared === -1) {\n    return indexOfSorted(item, array, compareFunction, pivot, end);\n  } else {\n    return indexOfSorted(item, array, compareFunction, start, pivot);\n  }\n}\n/**\n * Find the bounds of an element\n * taking padding and margin into account\n * @param {element} el\n * @returns {{ width: Number, height: Number}}\n * @memberof Core\n */\n\n\nfunction bounds(el) {\n  var style = window.getComputedStyle(el);\n  var widthProps = [\"width\", \"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\n  var heightProps = [\"height\", \"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\n  var width = 0;\n  var height = 0;\n  widthProps.forEach(function (prop) {\n    width += parseFloat(style[prop]) || 0;\n  });\n  heightProps.forEach(function (prop) {\n    height += parseFloat(style[prop]) || 0;\n  });\n  return {\n    height: height,\n    width: width\n  };\n}\n/**\n * Find the bounds of an element\n * taking padding, margin and borders into account\n * @param {element} el\n * @returns {{ width: Number, height: Number}}\n * @memberof Core\n */\n\n\nfunction borders(el) {\n  var style = window.getComputedStyle(el);\n  var widthProps = [\"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\n  var heightProps = [\"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\n  var width = 0;\n  var height = 0;\n  widthProps.forEach(function (prop) {\n    width += parseFloat(style[prop]) || 0;\n  });\n  heightProps.forEach(function (prop) {\n    height += parseFloat(style[prop]) || 0;\n  });\n  return {\n    height: height,\n    width: width\n  };\n}\n/**\n * Find the bounds of any node\n * allows for getting bounds of text nodes by wrapping them in a range\n * @param {node} node\n * @returns {BoundingClientRect}\n * @memberof Core\n */\n\n\nfunction nodeBounds(node) {\n  let elPos;\n  let doc = node.ownerDocument;\n\n  if (node.nodeType == Node.TEXT_NODE) {\n    let elRange = doc.createRange();\n    elRange.selectNodeContents(node);\n    elPos = elRange.getBoundingClientRect();\n  } else {\n    elPos = node.getBoundingClientRect();\n  }\n\n  return elPos;\n}\n/**\n * Find the equivalent of getBoundingClientRect of a browser window\n * @returns {{ width: Number, height: Number, top: Number, left: Number, right: Number, bottom: Number }}\n * @memberof Core\n */\n\n\nfunction windowBounds() {\n  var width = window.innerWidth;\n  var height = window.innerHeight;\n  return {\n    top: 0,\n    left: 0,\n    right: width,\n    bottom: height,\n    width: width,\n    height: height\n  };\n}\n/**\n * Gets the index of a node in its parent\n * @param {Node} node\n * @param {string} typeId\n * @return {number} index\n * @memberof Core\n */\n\n\nfunction indexOfNode(node, typeId) {\n  var parent = node.parentNode;\n  var children = parent.childNodes;\n  var sib;\n  var index = -1;\n\n  for (var i = 0; i < children.length; i++) {\n    sib = children[i];\n\n    if (sib.nodeType === typeId) {\n      index++;\n    }\n\n    if (sib == node) break;\n  }\n\n  return index;\n}\n/**\n * Gets the index of a text node in its parent\n * @param {node} textNode\n * @returns {number} index\n * @memberof Core\n */\n\n\nfunction indexOfTextNode(textNode) {\n  return indexOfNode(textNode, TEXT_NODE);\n}\n/**\n * Gets the index of an element node in its parent\n * @param {element} elementNode\n * @returns {number} index\n * @memberof Core\n */\n\n\nfunction indexOfElementNode(elementNode) {\n  return indexOfNode(elementNode, ELEMENT_NODE);\n}\n/**\n * Check if extension is xml\n * @param {string} ext\n * @returns {boolean}\n * @memberof Core\n */\n\n\nfunction isXml(ext) {\n  return [\"xml\", \"opf\", \"ncx\"].indexOf(ext) > -1;\n}\n/**\n * Create a new blob\n * @param {any} content\n * @param {string} mime\n * @returns {Blob}\n * @memberof Core\n */\n\n\nfunction createBlob(content, mime) {\n  return new Blob([content], {\n    type: mime\n  });\n}\n/**\n * Create a new blob url\n * @param {any} content\n * @param {string} mime\n * @returns {string} url\n * @memberof Core\n */\n\n\nfunction createBlobUrl(content, mime) {\n  var tempUrl;\n  var blob = createBlob(content, mime);\n  tempUrl = _URL.createObjectURL(blob);\n  return tempUrl;\n}\n/**\n * Remove a blob url\n * @param {string} url\n * @memberof Core\n */\n\n\nfunction revokeBlobUrl(url) {\n  return _URL.revokeObjectURL(url);\n}\n/**\n * Create a new base64 encoded url\n * @param {any} content\n * @param {string} mime\n * @returns {string} url\n * @memberof Core\n */\n\n\nfunction createBase64Url(content, mime) {\n  var data;\n  var datauri;\n\n  if (typeof content !== \"string\") {\n    // Only handles strings\n    return;\n  }\n\n  data = btoa(content);\n  datauri = \"data:\" + mime + \";base64,\" + data;\n  return datauri;\n}\n/**\n * Get type of an object\n * @param {object} obj\n * @returns {string} type\n * @memberof Core\n */\n\n\nfunction type(obj) {\n  return Object.prototype.toString.call(obj).slice(8, -1);\n}\n/**\n * Parse xml (or html) markup\n * @param {string} markup\n * @param {string} mime\n * @param {boolean} forceXMLDom force using xmlDom to parse instead of native parser\n * @returns {document} document\n * @memberof Core\n */\n\n\nfunction parse(markup, mime, forceXMLDom) {\n  var doc;\n  var Parser;\n\n  if (typeof DOMParser === \"undefined\" || forceXMLDom) {\n    Parser = _xmldom.DOMParser;\n  } else {\n    Parser = DOMParser;\n  } // Remove byte order mark before parsing\n  // https://www.w3.org/International/questions/qa-byte-order-mark\n\n\n  if (markup.charCodeAt(0) === 0xFEFF) {\n    markup = markup.slice(1);\n  }\n\n  doc = new Parser().parseFromString(markup, mime);\n  return doc;\n}\n/**\n * querySelector polyfill\n * @param {element} el\n * @param {string} sel selector string\n * @returns {element} element\n * @memberof Core\n */\n\n\nfunction qs(el, sel) {\n  var elements;\n\n  if (!el) {\n    throw new Error(\"No Element Provided\");\n  }\n\n  if (typeof el.querySelector != \"undefined\") {\n    return el.querySelector(sel);\n  } else {\n    elements = el.getElementsByTagName(sel);\n\n    if (elements.length) {\n      return elements[0];\n    }\n  }\n}\n/**\n * querySelectorAll polyfill\n * @param {element} el\n * @param {string} sel selector string\n * @returns {element[]} elements\n * @memberof Core\n */\n\n\nfunction qsa(el, sel) {\n  if (typeof el.querySelector != \"undefined\") {\n    return el.querySelectorAll(sel);\n  } else {\n    return el.getElementsByTagName(sel);\n  }\n}\n/**\n * querySelector by property\n * @param {element} el\n * @param {string} sel selector string\n * @param {object[]} props\n * @returns {element[]} elements\n * @memberof Core\n */\n\n\nfunction qsp(el, sel, props) {\n  var q, filtered;\n\n  if (typeof el.querySelector != \"undefined\") {\n    sel += \"[\";\n\n    for (var prop in props) {\n      sel += prop + \"~='\" + props[prop] + \"'\";\n    }\n\n    sel += \"]\";\n    return el.querySelector(sel);\n  } else {\n    q = el.getElementsByTagName(sel);\n    filtered = Array.prototype.slice.call(q, 0).filter(function (el) {\n      for (var prop in props) {\n        if (el.getAttribute(prop) === props[prop]) {\n          return true;\n        }\n      }\n\n      return false;\n    });\n\n    if (filtered) {\n      return filtered[0];\n    }\n  }\n}\n/**\n * Sprint through all text nodes in a document\n * @memberof Core\n * @param  {element} root element to start with\n * @param  {function} func function to run on each element\n */\n\n\nfunction sprint(root, func) {\n  var doc = root.ownerDocument || root;\n\n  if (typeof doc.createTreeWalker !== \"undefined\") {\n    treeWalker(root, func, NodeFilter.SHOW_TEXT);\n  } else {\n    walk(root, function (node) {\n      if (node && node.nodeType === 3) {\n        // Node.TEXT_NODE\n        func(node);\n      }\n    }, true);\n  }\n}\n/**\n * Create a treeWalker\n * @memberof Core\n * @param  {element} root element to start with\n * @param  {function} func function to run on each element\n * @param  {function | object} filter function or object to filter with\n */\n\n\nfunction treeWalker(root, func, filter) {\n  var treeWalker = document.createTreeWalker(root, filter, null, false);\n  let node;\n\n  while (node = treeWalker.nextNode()) {\n    func(node);\n  }\n}\n/**\n * @memberof Core\n * @param {node} node\n * @param {callback} return false for continue,true for break inside callback\n */\n\n\nfunction walk(node, callback) {\n  if (callback(node)) {\n    return true;\n  }\n\n  node = node.firstChild;\n\n  if (node) {\n    do {\n      let walked = walk(node, callback);\n\n      if (walked) {\n        return true;\n      }\n\n      node = node.nextSibling;\n    } while (node);\n  }\n}\n/**\n * Convert a blob to a base64 encoded string\n * @param {Blog} blob\n * @returns {string}\n * @memberof Core\n */\n\n\nfunction blob2base64(blob) {\n  return new Promise(function (resolve, reject) {\n    var reader = new FileReader();\n    reader.readAsDataURL(blob);\n\n    reader.onloadend = function () {\n      resolve(reader.result);\n    };\n  });\n}\n/**\n * Creates a new pending promise and provides methods to resolve or reject it.\n * From: https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Promise.jsm/Deferred#backwards_forwards_compatible\n * @memberof Core\n */\n\n\nfunction defer() {\n  /* A method to resolve the associated Promise with the value passed.\n   * If the promise is already settled it does nothing.\n   *\n   * @param {anything} value : This value is used to resolve the promise\n   * If the value is a Promise then the associated promise assumes the state\n   * of Promise passed as value.\n   */\n  this.resolve = null;\n  /* A method to reject the associated Promise with the value passed.\n   * If the promise is already settled it does nothing.\n   *\n   * @param {anything} reason: The reason for the rejection of the Promise.\n   * Generally its an Error object. If however a Promise is passed, then the Promise\n   * itself will be the reason for rejection no matter the state of the Promise.\n   */\n\n  this.reject = null;\n  this.id = uuid();\n  /* A newly created Pomise object.\n   * Initially in pending state.\n   */\n\n  this.promise = new Promise((resolve, reject) => {\n    this.resolve = resolve;\n    this.reject = reject;\n  });\n  Object.freeze(this);\n}\n/**\n * querySelector with filter by epub type\n * @param {element} html\n * @param {string} element element type to find\n * @param {string} type epub type to find\n * @returns {element[]} elements\n * @memberof Core\n */\n\n\nfunction querySelectorByType(html, element, type) {\n  var query;\n\n  if (typeof html.querySelector != \"undefined\") {\n    query = html.querySelector(`${element}[*|type=\"${type}\"]`);\n  } // Handle IE not supporting namespaced epub:type in querySelector\n\n\n  if (!query || query.length === 0) {\n    query = qsa(html, element);\n\n    for (var i = 0; i < query.length; i++) {\n      if (query[i].getAttributeNS(\"http://www.idpf.org/2007/ops\", \"type\") === type || query[i].getAttribute(\"epub:type\") === type) {\n        return query[i];\n      }\n    }\n  } else {\n    return query;\n  }\n}\n/**\n * Find direct descendents of an element\n * @param {element} el\n * @returns {element[]} children\n * @memberof Core\n */\n\n\nfunction findChildren(el) {\n  var result = [];\n  var childNodes = el.childNodes;\n\n  for (var i = 0; i < childNodes.length; i++) {\n    let node = childNodes[i];\n\n    if (node.nodeType === 1) {\n      result.push(node);\n    }\n  }\n\n  return result;\n}\n/**\n * Find all parents (ancestors) of an element\n * @param {element} node\n * @returns {element[]} parents\n * @memberof Core\n */\n\n\nfunction parents(node) {\n  var nodes = [node];\n\n  for (; node; node = node.parentNode) {\n    nodes.unshift(node);\n  }\n\n  return nodes;\n}\n/**\n * Find all direct descendents of a specific type\n * @param {element} el\n * @param {string} nodeName\n * @param {boolean} [single]\n * @returns {element[]} children\n * @memberof Core\n */\n\n\nfunction filterChildren(el, nodeName, single) {\n  var result = [];\n  var childNodes = el.childNodes;\n\n  for (var i = 0; i < childNodes.length; i++) {\n    let node = childNodes[i];\n\n    if (node.nodeType === 1 && node.nodeName.toLowerCase() === nodeName) {\n      if (single) {\n        return node;\n      } else {\n        result.push(node);\n      }\n    }\n  }\n\n  if (!single) {\n    return result;\n  }\n}\n/**\n * Filter all parents (ancestors) with tag name\n * @param {element} node\n * @param {string} tagname\n * @returns {element[]} parents\n * @memberof Core\n */\n\n\nfunction getParentByTagName(node, tagname) {\n  let parent;\n  if (node === null || tagname === '') return;\n  parent = node.parentNode;\n\n  while (parent.nodeType === 1) {\n    if (parent.tagName.toLowerCase() === tagname) {\n      return parent;\n    }\n\n    parent = parent.parentNode;\n  }\n}\n/**\n * Lightweight Polyfill for DOM Range\n * @class\n * @memberof Core\n */\n\n\nclass RangeObject {\n  constructor() {\n    this.collapsed = false;\n    this.commonAncestorContainer = undefined;\n    this.endContainer = undefined;\n    this.endOffset = undefined;\n    this.startContainer = undefined;\n    this.startOffset = undefined;\n  }\n\n  setStart(startNode, startOffset) {\n    this.startContainer = startNode;\n    this.startOffset = startOffset;\n\n    if (!this.endContainer) {\n      this.collapse(true);\n    } else {\n      this.commonAncestorContainer = this._commonAncestorContainer();\n    }\n\n    this._checkCollapsed();\n  }\n\n  setEnd(endNode, endOffset) {\n    this.endContainer = endNode;\n    this.endOffset = endOffset;\n\n    if (!this.startContainer) {\n      this.collapse(false);\n    } else {\n      this.collapsed = false;\n      this.commonAncestorContainer = this._commonAncestorContainer();\n    }\n\n    this._checkCollapsed();\n  }\n\n  collapse(toStart) {\n    this.collapsed = true;\n\n    if (toStart) {\n      this.endContainer = this.startContainer;\n      this.endOffset = this.startOffset;\n      this.commonAncestorContainer = this.startContainer.parentNode;\n    } else {\n      this.startContainer = this.endContainer;\n      this.startOffset = this.endOffset;\n      this.commonAncestorContainer = this.endOffset.parentNode;\n    }\n  }\n\n  selectNode(referenceNode) {\n    let parent = referenceNode.parentNode;\n    let index = Array.prototype.indexOf.call(parent.childNodes, referenceNode);\n    this.setStart(parent, index);\n    this.setEnd(parent, index + 1);\n  }\n\n  selectNodeContents(referenceNode) {\n    let end = referenceNode.childNodes[referenceNode.childNodes - 1];\n    let endIndex = referenceNode.nodeType === 3 ? referenceNode.textContent.length : parent.childNodes.length;\n    this.setStart(referenceNode, 0);\n    this.setEnd(referenceNode, endIndex);\n  }\n\n  _commonAncestorContainer(startContainer, endContainer) {\n    var startParents = parents(startContainer || this.startContainer);\n    var endParents = parents(endContainer || this.endContainer);\n    if (startParents[0] != endParents[0]) return undefined;\n\n    for (var i = 0; i < startParents.length; i++) {\n      if (startParents[i] != endParents[i]) {\n        return startParents[i - 1];\n      }\n    }\n  }\n\n  _checkCollapsed() {\n    if (this.startContainer === this.endContainer && this.startOffset === this.endOffset) {\n      this.collapsed = true;\n    } else {\n      this.collapsed = false;\n    }\n  }\n\n  toString() {// TODO: implement walking between start and end to find text\n  }\n\n}\n\nexports.RangeObject = RangeObject;","map":{"version":3,"sources":["S:/REACT/Ract-Js/Frlnce/node_modules/epubjs/lib/utils/core.js"],"names":["Object","defineProperty","exports","value","RangeObject","blob2base64","borders","bounds","createBase64Url","createBlob","createBlobUrl","defaults","defer","documentHeight","extend","filterChildren","findChildren","getParentByTagName","indexOfElementNode","indexOfNode","indexOfSorted","indexOfTextNode","insert","isElement","isFloat","isNumber","isXml","locationOf","nodeBounds","parents","parse","prefixed","qs","qsa","qsp","querySelectorByType","requestAnimationFrame","revokeBlobUrl","sprint","treeWalker","type","uuid","walk","windowBounds","_xmldom","require","window","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","ELEMENT_NODE","TEXT_NODE","COMMENT_NODE","DOCUMENT_NODE","_URL","URL","webkitURL","mozURL","undefined","d","Date","getTime","replace","c","r","Math","random","floor","toString","max","document","documentElement","clientHeight","body","scrollHeight","offsetHeight","obj","nodeType","n","isNaN","parseFloat","isFinite","f","indexOf","unprefixed","vendors","prefixes","lower","toLowerCase","length","style","i","arguments","source","prop","target","sources","slice","call","forEach","getOwnPropertyNames","propName","getOwnPropertyDescriptor","item","array","compareFunction","location","splice","_start","_end","start","end","pivot","parseInt","compared","a","b","el","getComputedStyle","widthProps","heightProps","width","height","node","elPos","doc","ownerDocument","Node","elRange","createRange","selectNodeContents","getBoundingClientRect","innerWidth","innerHeight","top","left","right","bottom","typeId","parent","parentNode","children","childNodes","sib","index","textNode","elementNode","ext","content","mime","Blob","tempUrl","blob","createObjectURL","url","revokeObjectURL","data","datauri","btoa","prototype","markup","forceXMLDom","Parser","DOMParser","charCodeAt","parseFromString","sel","elements","Error","querySelector","getElementsByTagName","querySelectorAll","props","q","filtered","Array","filter","getAttribute","root","func","createTreeWalker","NodeFilter","SHOW_TEXT","nextNode","callback","firstChild","walked","nextSibling","Promise","resolve","reject","reader","FileReader","readAsDataURL","onloadend","result","id","promise","freeze","html","element","query","getAttributeNS","push","nodes","unshift","nodeName","single","tagname","tagName","constructor","collapsed","commonAncestorContainer","endContainer","endOffset","startContainer","startOffset","setStart","startNode","collapse","_commonAncestorContainer","_checkCollapsed","setEnd","endNode","toStart","selectNode","referenceNode","endIndex","textContent","startParents","endParents"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.RangeObject = void 0;\nexports.blob2base64 = blob2base64;\nexports.borders = borders;\nexports.bounds = bounds;\nexports.createBase64Url = createBase64Url;\nexports.createBlob = createBlob;\nexports.createBlobUrl = createBlobUrl;\nexports.defaults = defaults;\nexports.defer = defer;\nexports.documentHeight = documentHeight;\nexports.extend = extend;\nexports.filterChildren = filterChildren;\nexports.findChildren = findChildren;\nexports.getParentByTagName = getParentByTagName;\nexports.indexOfElementNode = indexOfElementNode;\nexports.indexOfNode = indexOfNode;\nexports.indexOfSorted = indexOfSorted;\nexports.indexOfTextNode = indexOfTextNode;\nexports.insert = insert;\nexports.isElement = isElement;\nexports.isFloat = isFloat;\nexports.isNumber = isNumber;\nexports.isXml = isXml;\nexports.locationOf = locationOf;\nexports.nodeBounds = nodeBounds;\nexports.parents = parents;\nexports.parse = parse;\nexports.prefixed = prefixed;\nexports.qs = qs;\nexports.qsa = qsa;\nexports.qsp = qsp;\nexports.querySelectorByType = querySelectorByType;\nexports.requestAnimationFrame = void 0;\nexports.revokeBlobUrl = revokeBlobUrl;\nexports.sprint = sprint;\nexports.treeWalker = treeWalker;\nexports.type = type;\nexports.uuid = uuid;\nexports.walk = walk;\nexports.windowBounds = windowBounds;\n\nvar _xmldom = require(\"@xmldom/xmldom\");\n\n/**\n * Core Utilities and Helpers\n * @module Core\n*/\n\n/**\n * Vendor prefixed requestAnimationFrame\n * @returns {function} requestAnimationFrame\n * @memberof Core\n */\nconst requestAnimationFrame = typeof window != \"undefined\" ? window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame : false;\nexports.requestAnimationFrame = requestAnimationFrame;\nconst ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\nconst COMMENT_NODE = 8;\nconst DOCUMENT_NODE = 9;\n\nconst _URL = typeof URL != \"undefined\" ? URL : typeof window != \"undefined\" ? window.URL || window.webkitURL || window.mozURL : undefined;\n/**\n * Generates a UUID\n * based on: http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\n * @returns {string} uuid\n * @memberof Core\n */\n\n\nfunction uuid() {\n  var d = new Date().getTime();\n  var uuid = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (c) {\n    var r = (d + Math.random() * 16) % 16 | 0;\n    d = Math.floor(d / 16);\n    return (c == \"x\" ? r : r & 0x7 | 0x8).toString(16);\n  });\n  return uuid;\n}\n/**\n * Gets the height of a document\n * @returns {number} height\n * @memberof Core\n */\n\n\nfunction documentHeight() {\n  return Math.max(document.documentElement.clientHeight, document.body.scrollHeight, document.documentElement.scrollHeight, document.body.offsetHeight, document.documentElement.offsetHeight);\n}\n/**\n * Checks if a node is an element\n * @param {object} obj\n * @returns {boolean}\n * @memberof Core\n */\n\n\nfunction isElement(obj) {\n  return !!(obj && obj.nodeType == 1);\n}\n/**\n * @param {any} n\n * @returns {boolean}\n * @memberof Core\n */\n\n\nfunction isNumber(n) {\n  return !isNaN(parseFloat(n)) && isFinite(n);\n}\n/**\n * @param {any} n\n * @returns {boolean}\n * @memberof Core\n */\n\n\nfunction isFloat(n) {\n  let f = parseFloat(n);\n\n  if (isNumber(n) === false) {\n    return false;\n  }\n\n  if (typeof n === \"string\" && n.indexOf(\".\") > -1) {\n    return true;\n  }\n\n  return Math.floor(f) !== f;\n}\n/**\n * Get a prefixed css property\n * @param {string} unprefixed\n * @returns {string}\n * @memberof Core\n */\n\n\nfunction prefixed(unprefixed) {\n  var vendors = [\"Webkit\", \"webkit\", \"Moz\", \"O\", \"ms\"];\n  var prefixes = [\"-webkit-\", \"-webkit-\", \"-moz-\", \"-o-\", \"-ms-\"];\n  var lower = unprefixed.toLowerCase();\n  var length = vendors.length;\n\n  if (typeof document === \"undefined\" || typeof document.body.style[lower] != \"undefined\") {\n    return unprefixed;\n  }\n\n  for (var i = 0; i < length; i++) {\n    if (typeof document.body.style[prefixes[i] + lower] != \"undefined\") {\n      return prefixes[i] + lower;\n    }\n  }\n\n  return unprefixed;\n}\n/**\n * Apply defaults to an object\n * @param {object} obj\n * @returns {object}\n * @memberof Core\n */\n\n\nfunction defaults(obj) {\n  for (var i = 1, length = arguments.length; i < length; i++) {\n    var source = arguments[i];\n\n    for (var prop in source) {\n      if (obj[prop] === void 0) obj[prop] = source[prop];\n    }\n  }\n\n  return obj;\n}\n/**\n * Extend properties of an object\n * @param {object} target\n * @returns {object}\n * @memberof Core\n */\n\n\nfunction extend(target) {\n  var sources = [].slice.call(arguments, 1);\n  sources.forEach(function (source) {\n    if (!source) return;\n    Object.getOwnPropertyNames(source).forEach(function (propName) {\n      Object.defineProperty(target, propName, Object.getOwnPropertyDescriptor(source, propName));\n    });\n  });\n  return target;\n}\n/**\n * Fast quicksort insert for sorted array -- based on:\n *  http://stackoverflow.com/questions/1344500/efficient-way-to-insert-a-number-into-a-sorted-array-of-numbers\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @returns {number} location (in array)\n * @memberof Core\n */\n\n\nfunction insert(item, array, compareFunction) {\n  var location = locationOf(item, array, compareFunction);\n  array.splice(location, 0, item);\n  return location;\n}\n/**\n * Finds where something would fit into a sorted array\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @param {function} [_start]\n * @param {function} [_end]\n * @returns {number} location (in array)\n * @memberof Core\n */\n\n\nfunction locationOf(item, array, compareFunction, _start, _end) {\n  var start = _start || 0;\n  var end = _end || array.length;\n  var pivot = parseInt(start + (end - start) / 2);\n  var compared;\n\n  if (!compareFunction) {\n    compareFunction = function (a, b) {\n      if (a > b) return 1;\n      if (a < b) return -1;\n      if (a == b) return 0;\n    };\n  }\n\n  if (end - start <= 0) {\n    return pivot;\n  }\n\n  compared = compareFunction(array[pivot], item);\n\n  if (end - start === 1) {\n    return compared >= 0 ? pivot : pivot + 1;\n  }\n\n  if (compared === 0) {\n    return pivot;\n  }\n\n  if (compared === -1) {\n    return locationOf(item, array, compareFunction, pivot, end);\n  } else {\n    return locationOf(item, array, compareFunction, start, pivot);\n  }\n}\n/**\n * Finds index of something in a sorted array\n * Returns -1 if not found\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @param {function} [_start]\n * @param {function} [_end]\n * @returns {number} index (in array) or -1\n * @memberof Core\n */\n\n\nfunction indexOfSorted(item, array, compareFunction, _start, _end) {\n  var start = _start || 0;\n  var end = _end || array.length;\n  var pivot = parseInt(start + (end - start) / 2);\n  var compared;\n\n  if (!compareFunction) {\n    compareFunction = function (a, b) {\n      if (a > b) return 1;\n      if (a < b) return -1;\n      if (a == b) return 0;\n    };\n  }\n\n  if (end - start <= 0) {\n    return -1; // Not found\n  }\n\n  compared = compareFunction(array[pivot], item);\n\n  if (end - start === 1) {\n    return compared === 0 ? pivot : -1;\n  }\n\n  if (compared === 0) {\n    return pivot; // Found\n  }\n\n  if (compared === -1) {\n    return indexOfSorted(item, array, compareFunction, pivot, end);\n  } else {\n    return indexOfSorted(item, array, compareFunction, start, pivot);\n  }\n}\n/**\n * Find the bounds of an element\n * taking padding and margin into account\n * @param {element} el\n * @returns {{ width: Number, height: Number}}\n * @memberof Core\n */\n\n\nfunction bounds(el) {\n  var style = window.getComputedStyle(el);\n  var widthProps = [\"width\", \"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\n  var heightProps = [\"height\", \"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\n  var width = 0;\n  var height = 0;\n  widthProps.forEach(function (prop) {\n    width += parseFloat(style[prop]) || 0;\n  });\n  heightProps.forEach(function (prop) {\n    height += parseFloat(style[prop]) || 0;\n  });\n  return {\n    height: height,\n    width: width\n  };\n}\n/**\n * Find the bounds of an element\n * taking padding, margin and borders into account\n * @param {element} el\n * @returns {{ width: Number, height: Number}}\n * @memberof Core\n */\n\n\nfunction borders(el) {\n  var style = window.getComputedStyle(el);\n  var widthProps = [\"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\n  var heightProps = [\"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\n  var width = 0;\n  var height = 0;\n  widthProps.forEach(function (prop) {\n    width += parseFloat(style[prop]) || 0;\n  });\n  heightProps.forEach(function (prop) {\n    height += parseFloat(style[prop]) || 0;\n  });\n  return {\n    height: height,\n    width: width\n  };\n}\n/**\n * Find the bounds of any node\n * allows for getting bounds of text nodes by wrapping them in a range\n * @param {node} node\n * @returns {BoundingClientRect}\n * @memberof Core\n */\n\n\nfunction nodeBounds(node) {\n  let elPos;\n  let doc = node.ownerDocument;\n\n  if (node.nodeType == Node.TEXT_NODE) {\n    let elRange = doc.createRange();\n    elRange.selectNodeContents(node);\n    elPos = elRange.getBoundingClientRect();\n  } else {\n    elPos = node.getBoundingClientRect();\n  }\n\n  return elPos;\n}\n/**\n * Find the equivalent of getBoundingClientRect of a browser window\n * @returns {{ width: Number, height: Number, top: Number, left: Number, right: Number, bottom: Number }}\n * @memberof Core\n */\n\n\nfunction windowBounds() {\n  var width = window.innerWidth;\n  var height = window.innerHeight;\n  return {\n    top: 0,\n    left: 0,\n    right: width,\n    bottom: height,\n    width: width,\n    height: height\n  };\n}\n/**\n * Gets the index of a node in its parent\n * @param {Node} node\n * @param {string} typeId\n * @return {number} index\n * @memberof Core\n */\n\n\nfunction indexOfNode(node, typeId) {\n  var parent = node.parentNode;\n  var children = parent.childNodes;\n  var sib;\n  var index = -1;\n\n  for (var i = 0; i < children.length; i++) {\n    sib = children[i];\n\n    if (sib.nodeType === typeId) {\n      index++;\n    }\n\n    if (sib == node) break;\n  }\n\n  return index;\n}\n/**\n * Gets the index of a text node in its parent\n * @param {node} textNode\n * @returns {number} index\n * @memberof Core\n */\n\n\nfunction indexOfTextNode(textNode) {\n  return indexOfNode(textNode, TEXT_NODE);\n}\n/**\n * Gets the index of an element node in its parent\n * @param {element} elementNode\n * @returns {number} index\n * @memberof Core\n */\n\n\nfunction indexOfElementNode(elementNode) {\n  return indexOfNode(elementNode, ELEMENT_NODE);\n}\n/**\n * Check if extension is xml\n * @param {string} ext\n * @returns {boolean}\n * @memberof Core\n */\n\n\nfunction isXml(ext) {\n  return [\"xml\", \"opf\", \"ncx\"].indexOf(ext) > -1;\n}\n/**\n * Create a new blob\n * @param {any} content\n * @param {string} mime\n * @returns {Blob}\n * @memberof Core\n */\n\n\nfunction createBlob(content, mime) {\n  return new Blob([content], {\n    type: mime\n  });\n}\n/**\n * Create a new blob url\n * @param {any} content\n * @param {string} mime\n * @returns {string} url\n * @memberof Core\n */\n\n\nfunction createBlobUrl(content, mime) {\n  var tempUrl;\n  var blob = createBlob(content, mime);\n  tempUrl = _URL.createObjectURL(blob);\n  return tempUrl;\n}\n/**\n * Remove a blob url\n * @param {string} url\n * @memberof Core\n */\n\n\nfunction revokeBlobUrl(url) {\n  return _URL.revokeObjectURL(url);\n}\n/**\n * Create a new base64 encoded url\n * @param {any} content\n * @param {string} mime\n * @returns {string} url\n * @memberof Core\n */\n\n\nfunction createBase64Url(content, mime) {\n  var data;\n  var datauri;\n\n  if (typeof content !== \"string\") {\n    // Only handles strings\n    return;\n  }\n\n  data = btoa(content);\n  datauri = \"data:\" + mime + \";base64,\" + data;\n  return datauri;\n}\n/**\n * Get type of an object\n * @param {object} obj\n * @returns {string} type\n * @memberof Core\n */\n\n\nfunction type(obj) {\n  return Object.prototype.toString.call(obj).slice(8, -1);\n}\n/**\n * Parse xml (or html) markup\n * @param {string} markup\n * @param {string} mime\n * @param {boolean} forceXMLDom force using xmlDom to parse instead of native parser\n * @returns {document} document\n * @memberof Core\n */\n\n\nfunction parse(markup, mime, forceXMLDom) {\n  var doc;\n  var Parser;\n\n  if (typeof DOMParser === \"undefined\" || forceXMLDom) {\n    Parser = _xmldom.DOMParser;\n  } else {\n    Parser = DOMParser;\n  } // Remove byte order mark before parsing\n  // https://www.w3.org/International/questions/qa-byte-order-mark\n\n\n  if (markup.charCodeAt(0) === 0xFEFF) {\n    markup = markup.slice(1);\n  }\n\n  doc = new Parser().parseFromString(markup, mime);\n  return doc;\n}\n/**\n * querySelector polyfill\n * @param {element} el\n * @param {string} sel selector string\n * @returns {element} element\n * @memberof Core\n */\n\n\nfunction qs(el, sel) {\n  var elements;\n\n  if (!el) {\n    throw new Error(\"No Element Provided\");\n  }\n\n  if (typeof el.querySelector != \"undefined\") {\n    return el.querySelector(sel);\n  } else {\n    elements = el.getElementsByTagName(sel);\n\n    if (elements.length) {\n      return elements[0];\n    }\n  }\n}\n/**\n * querySelectorAll polyfill\n * @param {element} el\n * @param {string} sel selector string\n * @returns {element[]} elements\n * @memberof Core\n */\n\n\nfunction qsa(el, sel) {\n  if (typeof el.querySelector != \"undefined\") {\n    return el.querySelectorAll(sel);\n  } else {\n    return el.getElementsByTagName(sel);\n  }\n}\n/**\n * querySelector by property\n * @param {element} el\n * @param {string} sel selector string\n * @param {object[]} props\n * @returns {element[]} elements\n * @memberof Core\n */\n\n\nfunction qsp(el, sel, props) {\n  var q, filtered;\n\n  if (typeof el.querySelector != \"undefined\") {\n    sel += \"[\";\n\n    for (var prop in props) {\n      sel += prop + \"~='\" + props[prop] + \"'\";\n    }\n\n    sel += \"]\";\n    return el.querySelector(sel);\n  } else {\n    q = el.getElementsByTagName(sel);\n    filtered = Array.prototype.slice.call(q, 0).filter(function (el) {\n      for (var prop in props) {\n        if (el.getAttribute(prop) === props[prop]) {\n          return true;\n        }\n      }\n\n      return false;\n    });\n\n    if (filtered) {\n      return filtered[0];\n    }\n  }\n}\n/**\n * Sprint through all text nodes in a document\n * @memberof Core\n * @param  {element} root element to start with\n * @param  {function} func function to run on each element\n */\n\n\nfunction sprint(root, func) {\n  var doc = root.ownerDocument || root;\n\n  if (typeof doc.createTreeWalker !== \"undefined\") {\n    treeWalker(root, func, NodeFilter.SHOW_TEXT);\n  } else {\n    walk(root, function (node) {\n      if (node && node.nodeType === 3) {\n        // Node.TEXT_NODE\n        func(node);\n      }\n    }, true);\n  }\n}\n/**\n * Create a treeWalker\n * @memberof Core\n * @param  {element} root element to start with\n * @param  {function} func function to run on each element\n * @param  {function | object} filter function or object to filter with\n */\n\n\nfunction treeWalker(root, func, filter) {\n  var treeWalker = document.createTreeWalker(root, filter, null, false);\n  let node;\n\n  while (node = treeWalker.nextNode()) {\n    func(node);\n  }\n}\n/**\n * @memberof Core\n * @param {node} node\n * @param {callback} return false for continue,true for break inside callback\n */\n\n\nfunction walk(node, callback) {\n  if (callback(node)) {\n    return true;\n  }\n\n  node = node.firstChild;\n\n  if (node) {\n    do {\n      let walked = walk(node, callback);\n\n      if (walked) {\n        return true;\n      }\n\n      node = node.nextSibling;\n    } while (node);\n  }\n}\n/**\n * Convert a blob to a base64 encoded string\n * @param {Blog} blob\n * @returns {string}\n * @memberof Core\n */\n\n\nfunction blob2base64(blob) {\n  return new Promise(function (resolve, reject) {\n    var reader = new FileReader();\n    reader.readAsDataURL(blob);\n\n    reader.onloadend = function () {\n      resolve(reader.result);\n    };\n  });\n}\n/**\n * Creates a new pending promise and provides methods to resolve or reject it.\n * From: https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Promise.jsm/Deferred#backwards_forwards_compatible\n * @memberof Core\n */\n\n\nfunction defer() {\n  /* A method to resolve the associated Promise with the value passed.\n   * If the promise is already settled it does nothing.\n   *\n   * @param {anything} value : This value is used to resolve the promise\n   * If the value is a Promise then the associated promise assumes the state\n   * of Promise passed as value.\n   */\n  this.resolve = null;\n  /* A method to reject the associated Promise with the value passed.\n   * If the promise is already settled it does nothing.\n   *\n   * @param {anything} reason: The reason for the rejection of the Promise.\n   * Generally its an Error object. If however a Promise is passed, then the Promise\n   * itself will be the reason for rejection no matter the state of the Promise.\n   */\n\n  this.reject = null;\n  this.id = uuid();\n  /* A newly created Pomise object.\n   * Initially in pending state.\n   */\n\n  this.promise = new Promise((resolve, reject) => {\n    this.resolve = resolve;\n    this.reject = reject;\n  });\n  Object.freeze(this);\n}\n/**\n * querySelector with filter by epub type\n * @param {element} html\n * @param {string} element element type to find\n * @param {string} type epub type to find\n * @returns {element[]} elements\n * @memberof Core\n */\n\n\nfunction querySelectorByType(html, element, type) {\n  var query;\n\n  if (typeof html.querySelector != \"undefined\") {\n    query = html.querySelector(`${element}[*|type=\"${type}\"]`);\n  } // Handle IE not supporting namespaced epub:type in querySelector\n\n\n  if (!query || query.length === 0) {\n    query = qsa(html, element);\n\n    for (var i = 0; i < query.length; i++) {\n      if (query[i].getAttributeNS(\"http://www.idpf.org/2007/ops\", \"type\") === type || query[i].getAttribute(\"epub:type\") === type) {\n        return query[i];\n      }\n    }\n  } else {\n    return query;\n  }\n}\n/**\n * Find direct descendents of an element\n * @param {element} el\n * @returns {element[]} children\n * @memberof Core\n */\n\n\nfunction findChildren(el) {\n  var result = [];\n  var childNodes = el.childNodes;\n\n  for (var i = 0; i < childNodes.length; i++) {\n    let node = childNodes[i];\n\n    if (node.nodeType === 1) {\n      result.push(node);\n    }\n  }\n\n  return result;\n}\n/**\n * Find all parents (ancestors) of an element\n * @param {element} node\n * @returns {element[]} parents\n * @memberof Core\n */\n\n\nfunction parents(node) {\n  var nodes = [node];\n\n  for (; node; node = node.parentNode) {\n    nodes.unshift(node);\n  }\n\n  return nodes;\n}\n/**\n * Find all direct descendents of a specific type\n * @param {element} el\n * @param {string} nodeName\n * @param {boolean} [single]\n * @returns {element[]} children\n * @memberof Core\n */\n\n\nfunction filterChildren(el, nodeName, single) {\n  var result = [];\n  var childNodes = el.childNodes;\n\n  for (var i = 0; i < childNodes.length; i++) {\n    let node = childNodes[i];\n\n    if (node.nodeType === 1 && node.nodeName.toLowerCase() === nodeName) {\n      if (single) {\n        return node;\n      } else {\n        result.push(node);\n      }\n    }\n  }\n\n  if (!single) {\n    return result;\n  }\n}\n/**\n * Filter all parents (ancestors) with tag name\n * @param {element} node\n * @param {string} tagname\n * @returns {element[]} parents\n * @memberof Core\n */\n\n\nfunction getParentByTagName(node, tagname) {\n  let parent;\n  if (node === null || tagname === '') return;\n  parent = node.parentNode;\n\n  while (parent.nodeType === 1) {\n    if (parent.tagName.toLowerCase() === tagname) {\n      return parent;\n    }\n\n    parent = parent.parentNode;\n  }\n}\n/**\n * Lightweight Polyfill for DOM Range\n * @class\n * @memberof Core\n */\n\n\nclass RangeObject {\n  constructor() {\n    this.collapsed = false;\n    this.commonAncestorContainer = undefined;\n    this.endContainer = undefined;\n    this.endOffset = undefined;\n    this.startContainer = undefined;\n    this.startOffset = undefined;\n  }\n\n  setStart(startNode, startOffset) {\n    this.startContainer = startNode;\n    this.startOffset = startOffset;\n\n    if (!this.endContainer) {\n      this.collapse(true);\n    } else {\n      this.commonAncestorContainer = this._commonAncestorContainer();\n    }\n\n    this._checkCollapsed();\n  }\n\n  setEnd(endNode, endOffset) {\n    this.endContainer = endNode;\n    this.endOffset = endOffset;\n\n    if (!this.startContainer) {\n      this.collapse(false);\n    } else {\n      this.collapsed = false;\n      this.commonAncestorContainer = this._commonAncestorContainer();\n    }\n\n    this._checkCollapsed();\n  }\n\n  collapse(toStart) {\n    this.collapsed = true;\n\n    if (toStart) {\n      this.endContainer = this.startContainer;\n      this.endOffset = this.startOffset;\n      this.commonAncestorContainer = this.startContainer.parentNode;\n    } else {\n      this.startContainer = this.endContainer;\n      this.startOffset = this.endOffset;\n      this.commonAncestorContainer = this.endOffset.parentNode;\n    }\n  }\n\n  selectNode(referenceNode) {\n    let parent = referenceNode.parentNode;\n    let index = Array.prototype.indexOf.call(parent.childNodes, referenceNode);\n    this.setStart(parent, index);\n    this.setEnd(parent, index + 1);\n  }\n\n  selectNodeContents(referenceNode) {\n    let end = referenceNode.childNodes[referenceNode.childNodes - 1];\n    let endIndex = referenceNode.nodeType === 3 ? referenceNode.textContent.length : parent.childNodes.length;\n    this.setStart(referenceNode, 0);\n    this.setEnd(referenceNode, endIndex);\n  }\n\n  _commonAncestorContainer(startContainer, endContainer) {\n    var startParents = parents(startContainer || this.startContainer);\n    var endParents = parents(endContainer || this.endContainer);\n    if (startParents[0] != endParents[0]) return undefined;\n\n    for (var i = 0; i < startParents.length; i++) {\n      if (startParents[i] != endParents[i]) {\n        return startParents[i - 1];\n      }\n    }\n  }\n\n  _checkCollapsed() {\n    if (this.startContainer === this.endContainer && this.startOffset === this.endOffset) {\n      this.collapsed = true;\n    } else {\n      this.collapsed = false;\n    }\n  }\n\n  toString() {// TODO: implement walking between start and end to find text\n  }\n\n}\n\nexports.RangeObject = RangeObject;"]},"metadata":{},"sourceType":"script"}