{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _core = require(\"../../utils/core\");\n\nvar _constants = require(\"../../utils/constants\");\n\nvar _eventEmitter = _interopRequireDefault(require(\"event-emitter\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n} // easing equations from https://github.com/danro/easing-js/blob/master/easing.js\n\n\nconst PI_D2 = Math.PI / 2;\nconst EASING_EQUATIONS = {\n  easeOutSine: function (pos) {\n    return Math.sin(pos * PI_D2);\n  },\n  easeInOutSine: function (pos) {\n    return -0.5 * (Math.cos(Math.PI * pos) - 1);\n  },\n  easeInOutQuint: function (pos) {\n    if ((pos /= 0.5) < 1) {\n      return 0.5 * Math.pow(pos, 5);\n    }\n\n    return 0.5 * (Math.pow(pos - 2, 5) + 2);\n  },\n  easeInCubic: function (pos) {\n    return Math.pow(pos, 3);\n  }\n};\n\nclass Snap {\n  constructor(manager, options) {\n    this.settings = (0, _core.extend)({\n      duration: 80,\n      minVelocity: 0.2,\n      minDistance: 10,\n      easing: EASING_EQUATIONS['easeInCubic']\n    }, options || {});\n    this.supportsTouch = this.supportsTouch();\n\n    if (this.supportsTouch) {\n      this.setup(manager);\n    }\n  }\n\n  setup(manager) {\n    this.manager = manager;\n    this.layout = this.manager.layout;\n    this.fullsize = this.manager.settings.fullsize;\n\n    if (this.fullsize) {\n      this.element = this.manager.stage.element;\n      this.scroller = window;\n      this.disableScroll();\n    } else {\n      this.element = this.manager.stage.container;\n      this.scroller = this.element;\n      this.element.style[\"WebkitOverflowScrolling\"] = \"touch\";\n    } // this.overflow = this.manager.overflow;\n    // set lookahead offset to page width\n\n\n    this.manager.settings.offset = this.layout.width;\n    this.manager.settings.afterScrolledTimeout = this.settings.duration * 2;\n    this.isVertical = this.manager.settings.axis === \"vertical\"; // disable snapping if not paginated or axis in not horizontal\n\n    if (!this.manager.isPaginated || this.isVertical) {\n      return;\n    }\n\n    this.touchCanceler = false;\n    this.resizeCanceler = false;\n    this.snapping = false;\n    this.scrollLeft;\n    this.scrollTop;\n    this.startTouchX = undefined;\n    this.startTouchY = undefined;\n    this.startTime = undefined;\n    this.endTouchX = undefined;\n    this.endTouchY = undefined;\n    this.endTime = undefined;\n    this.addListeners();\n  }\n\n  supportsTouch() {\n    if ('ontouchstart' in window || window.DocumentTouch && document instanceof DocumentTouch) {\n      return true;\n    }\n\n    return false;\n  }\n\n  disableScroll() {\n    this.element.style.overflow = \"hidden\";\n  }\n\n  enableScroll() {\n    this.element.style.overflow = \"\";\n  }\n\n  addListeners() {\n    this._onResize = this.onResize.bind(this);\n    window.addEventListener('resize', this._onResize);\n    this._onScroll = this.onScroll.bind(this);\n    this.scroller.addEventListener('scroll', this._onScroll);\n    this._onTouchStart = this.onTouchStart.bind(this);\n    this.scroller.addEventListener('touchstart', this._onTouchStart, {\n      passive: true\n    });\n    this.on('touchstart', this._onTouchStart);\n    this._onTouchMove = this.onTouchMove.bind(this);\n    this.scroller.addEventListener('touchmove', this._onTouchMove, {\n      passive: true\n    });\n    this.on('touchmove', this._onTouchMove);\n    this._onTouchEnd = this.onTouchEnd.bind(this);\n    this.scroller.addEventListener('touchend', this._onTouchEnd, {\n      passive: true\n    });\n    this.on('touchend', this._onTouchEnd);\n    this._afterDisplayed = this.afterDisplayed.bind(this);\n    this.manager.on(_constants.EVENTS.MANAGERS.ADDED, this._afterDisplayed);\n  }\n\n  removeListeners() {\n    window.removeEventListener('resize', this._onResize);\n    this._onResize = undefined;\n    this.scroller.removeEventListener('scroll', this._onScroll);\n    this._onScroll = undefined;\n    this.scroller.removeEventListener('touchstart', this._onTouchStart, {\n      passive: true\n    });\n    this.off('touchstart', this._onTouchStart);\n    this._onTouchStart = undefined;\n    this.scroller.removeEventListener('touchmove', this._onTouchMove, {\n      passive: true\n    });\n    this.off('touchmove', this._onTouchMove);\n    this._onTouchMove = undefined;\n    this.scroller.removeEventListener('touchend', this._onTouchEnd, {\n      passive: true\n    });\n    this.off('touchend', this._onTouchEnd);\n    this._onTouchEnd = undefined;\n    this.manager.off(_constants.EVENTS.MANAGERS.ADDED, this._afterDisplayed);\n    this._afterDisplayed = undefined;\n  }\n\n  afterDisplayed(view) {\n    let contents = view.contents;\n    [\"touchstart\", \"touchmove\", \"touchend\"].forEach(e => {\n      contents.on(e, ev => this.triggerViewEvent(ev, contents));\n    });\n  }\n\n  triggerViewEvent(e, contents) {\n    this.emit(e.type, e, contents);\n  }\n\n  onScroll(e) {\n    this.scrollLeft = this.fullsize ? window.scrollX : this.scroller.scrollLeft;\n    this.scrollTop = this.fullsize ? window.scrollY : this.scroller.scrollTop;\n  }\n\n  onResize(e) {\n    this.resizeCanceler = true;\n  }\n\n  onTouchStart(e) {\n    let {\n      screenX,\n      screenY\n    } = e.touches[0];\n\n    if (this.fullsize) {\n      this.enableScroll();\n    }\n\n    this.touchCanceler = true;\n\n    if (!this.startTouchX) {\n      this.startTouchX = screenX;\n      this.startTouchY = screenY;\n      this.startTime = this.now();\n    }\n\n    this.endTouchX = screenX;\n    this.endTouchY = screenY;\n    this.endTime = this.now();\n  }\n\n  onTouchMove(e) {\n    let {\n      screenX,\n      screenY\n    } = e.touches[0];\n    let deltaY = Math.abs(screenY - this.endTouchY);\n    this.touchCanceler = true;\n\n    if (!this.fullsize && deltaY < 10) {\n      this.element.scrollLeft -= screenX - this.endTouchX;\n    }\n\n    this.endTouchX = screenX;\n    this.endTouchY = screenY;\n    this.endTime = this.now();\n  }\n\n  onTouchEnd(e) {\n    if (this.fullsize) {\n      this.disableScroll();\n    }\n\n    this.touchCanceler = false;\n    let swipped = this.wasSwiped();\n\n    if (swipped !== 0) {\n      this.snap(swipped);\n    } else {\n      this.snap();\n    }\n\n    this.startTouchX = undefined;\n    this.startTouchY = undefined;\n    this.startTime = undefined;\n    this.endTouchX = undefined;\n    this.endTouchY = undefined;\n    this.endTime = undefined;\n  }\n\n  wasSwiped() {\n    let snapWidth = this.layout.pageWidth * this.layout.divisor;\n    let distance = this.endTouchX - this.startTouchX;\n    let absolute = Math.abs(distance);\n    let time = this.endTime - this.startTime;\n    let velocity = distance / time;\n    let minVelocity = this.settings.minVelocity;\n\n    if (absolute <= this.settings.minDistance || absolute >= snapWidth) {\n      return 0;\n    }\n\n    if (velocity > minVelocity) {\n      // previous\n      return -1;\n    } else if (velocity < -minVelocity) {\n      // next\n      return 1;\n    }\n  }\n\n  needsSnap() {\n    let left = this.scrollLeft;\n    let snapWidth = this.layout.pageWidth * this.layout.divisor;\n    return left % snapWidth !== 0;\n  }\n\n  snap() {\n    let howMany = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n    let left = this.scrollLeft;\n    let snapWidth = this.layout.pageWidth * this.layout.divisor;\n    let snapTo = Math.round(left / snapWidth) * snapWidth;\n\n    if (howMany) {\n      snapTo += howMany * snapWidth;\n    }\n\n    return this.smoothScrollTo(snapTo);\n  }\n\n  smoothScrollTo(destination) {\n    const deferred = new _core.defer();\n    const start = this.scrollLeft;\n    const startTime = this.now();\n    const duration = this.settings.duration;\n    const easing = this.settings.easing;\n    this.snapping = true; // add animation loop\n\n    function tick() {\n      const now = this.now();\n      const time = Math.min(1, (now - startTime) / duration);\n      const timeFunction = easing(time);\n\n      if (this.touchCanceler || this.resizeCanceler) {\n        this.resizeCanceler = false;\n        this.snapping = false;\n        deferred.resolve();\n        return;\n      }\n\n      if (time < 1) {\n        window.requestAnimationFrame(tick.bind(this));\n        this.scrollTo(start + (destination - start) * time, 0);\n      } else {\n        this.scrollTo(destination, 0);\n        this.snapping = false;\n        deferred.resolve();\n      }\n    }\n\n    tick.call(this);\n    return deferred.promise;\n  }\n\n  scrollTo() {\n    let left = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n    let top = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\n    if (this.fullsize) {\n      window.scroll(left, top);\n    } else {\n      this.scroller.scrollLeft = left;\n      this.scroller.scrollTop = top;\n    }\n  }\n\n  now() {\n    return 'now' in window.performance ? performance.now() : new Date().getTime();\n  }\n\n  destroy() {\n    if (!this.scroller) {\n      return;\n    }\n\n    if (this.fullsize) {\n      this.enableScroll();\n    }\n\n    this.removeListeners();\n    this.scroller = undefined;\n  }\n\n}\n\n(0, _eventEmitter.default)(Snap.prototype);\nvar _default = Snap;\nexports.default = _default;","map":{"version":3,"sources":["S:/REACT/Ract-Js/Frlnce/node_modules/epubjs/lib/managers/helpers/snap.js"],"names":["Object","defineProperty","exports","value","default","_core","require","_constants","_eventEmitter","_interopRequireDefault","obj","__esModule","PI_D2","Math","PI","EASING_EQUATIONS","easeOutSine","pos","sin","easeInOutSine","cos","easeInOutQuint","pow","easeInCubic","Snap","constructor","manager","options","settings","extend","duration","minVelocity","minDistance","easing","supportsTouch","setup","layout","fullsize","element","stage","scroller","window","disableScroll","container","style","offset","width","afterScrolledTimeout","isVertical","axis","isPaginated","touchCanceler","resizeCanceler","snapping","scrollLeft","scrollTop","startTouchX","undefined","startTouchY","startTime","endTouchX","endTouchY","endTime","addListeners","DocumentTouch","document","overflow","enableScroll","_onResize","onResize","bind","addEventListener","_onScroll","onScroll","_onTouchStart","onTouchStart","passive","on","_onTouchMove","onTouchMove","_onTouchEnd","onTouchEnd","_afterDisplayed","afterDisplayed","EVENTS","MANAGERS","ADDED","removeListeners","removeEventListener","off","view","contents","forEach","e","ev","triggerViewEvent","emit","type","scrollX","scrollY","screenX","screenY","touches","now","deltaY","abs","swipped","wasSwiped","snap","snapWidth","pageWidth","divisor","distance","absolute","time","velocity","needsSnap","left","howMany","snapTo","round","smoothScrollTo","destination","deferred","defer","start","tick","min","timeFunction","resolve","requestAnimationFrame","scrollTo","call","promise","top","scroll","performance","Date","getTime","destroy","prototype","_default"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _core = require(\"../../utils/core\");\n\nvar _constants = require(\"../../utils/constants\");\n\nvar _eventEmitter = _interopRequireDefault(require(\"event-emitter\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// easing equations from https://github.com/danro/easing-js/blob/master/easing.js\nconst PI_D2 = Math.PI / 2;\nconst EASING_EQUATIONS = {\n  easeOutSine: function (pos) {\n    return Math.sin(pos * PI_D2);\n  },\n  easeInOutSine: function (pos) {\n    return -0.5 * (Math.cos(Math.PI * pos) - 1);\n  },\n  easeInOutQuint: function (pos) {\n    if ((pos /= 0.5) < 1) {\n      return 0.5 * Math.pow(pos, 5);\n    }\n\n    return 0.5 * (Math.pow(pos - 2, 5) + 2);\n  },\n  easeInCubic: function (pos) {\n    return Math.pow(pos, 3);\n  }\n};\n\nclass Snap {\n  constructor(manager, options) {\n    this.settings = (0, _core.extend)({\n      duration: 80,\n      minVelocity: 0.2,\n      minDistance: 10,\n      easing: EASING_EQUATIONS['easeInCubic']\n    }, options || {});\n    this.supportsTouch = this.supportsTouch();\n\n    if (this.supportsTouch) {\n      this.setup(manager);\n    }\n  }\n\n  setup(manager) {\n    this.manager = manager;\n    this.layout = this.manager.layout;\n    this.fullsize = this.manager.settings.fullsize;\n\n    if (this.fullsize) {\n      this.element = this.manager.stage.element;\n      this.scroller = window;\n      this.disableScroll();\n    } else {\n      this.element = this.manager.stage.container;\n      this.scroller = this.element;\n      this.element.style[\"WebkitOverflowScrolling\"] = \"touch\";\n    } // this.overflow = this.manager.overflow;\n    // set lookahead offset to page width\n\n\n    this.manager.settings.offset = this.layout.width;\n    this.manager.settings.afterScrolledTimeout = this.settings.duration * 2;\n    this.isVertical = this.manager.settings.axis === \"vertical\"; // disable snapping if not paginated or axis in not horizontal\n\n    if (!this.manager.isPaginated || this.isVertical) {\n      return;\n    }\n\n    this.touchCanceler = false;\n    this.resizeCanceler = false;\n    this.snapping = false;\n    this.scrollLeft;\n    this.scrollTop;\n    this.startTouchX = undefined;\n    this.startTouchY = undefined;\n    this.startTime = undefined;\n    this.endTouchX = undefined;\n    this.endTouchY = undefined;\n    this.endTime = undefined;\n    this.addListeners();\n  }\n\n  supportsTouch() {\n    if ('ontouchstart' in window || window.DocumentTouch && document instanceof DocumentTouch) {\n      return true;\n    }\n\n    return false;\n  }\n\n  disableScroll() {\n    this.element.style.overflow = \"hidden\";\n  }\n\n  enableScroll() {\n    this.element.style.overflow = \"\";\n  }\n\n  addListeners() {\n    this._onResize = this.onResize.bind(this);\n    window.addEventListener('resize', this._onResize);\n    this._onScroll = this.onScroll.bind(this);\n    this.scroller.addEventListener('scroll', this._onScroll);\n    this._onTouchStart = this.onTouchStart.bind(this);\n    this.scroller.addEventListener('touchstart', this._onTouchStart, {\n      passive: true\n    });\n    this.on('touchstart', this._onTouchStart);\n    this._onTouchMove = this.onTouchMove.bind(this);\n    this.scroller.addEventListener('touchmove', this._onTouchMove, {\n      passive: true\n    });\n    this.on('touchmove', this._onTouchMove);\n    this._onTouchEnd = this.onTouchEnd.bind(this);\n    this.scroller.addEventListener('touchend', this._onTouchEnd, {\n      passive: true\n    });\n    this.on('touchend', this._onTouchEnd);\n    this._afterDisplayed = this.afterDisplayed.bind(this);\n    this.manager.on(_constants.EVENTS.MANAGERS.ADDED, this._afterDisplayed);\n  }\n\n  removeListeners() {\n    window.removeEventListener('resize', this._onResize);\n    this._onResize = undefined;\n    this.scroller.removeEventListener('scroll', this._onScroll);\n    this._onScroll = undefined;\n    this.scroller.removeEventListener('touchstart', this._onTouchStart, {\n      passive: true\n    });\n    this.off('touchstart', this._onTouchStart);\n    this._onTouchStart = undefined;\n    this.scroller.removeEventListener('touchmove', this._onTouchMove, {\n      passive: true\n    });\n    this.off('touchmove', this._onTouchMove);\n    this._onTouchMove = undefined;\n    this.scroller.removeEventListener('touchend', this._onTouchEnd, {\n      passive: true\n    });\n    this.off('touchend', this._onTouchEnd);\n    this._onTouchEnd = undefined;\n    this.manager.off(_constants.EVENTS.MANAGERS.ADDED, this._afterDisplayed);\n    this._afterDisplayed = undefined;\n  }\n\n  afterDisplayed(view) {\n    let contents = view.contents;\n    [\"touchstart\", \"touchmove\", \"touchend\"].forEach(e => {\n      contents.on(e, ev => this.triggerViewEvent(ev, contents));\n    });\n  }\n\n  triggerViewEvent(e, contents) {\n    this.emit(e.type, e, contents);\n  }\n\n  onScroll(e) {\n    this.scrollLeft = this.fullsize ? window.scrollX : this.scroller.scrollLeft;\n    this.scrollTop = this.fullsize ? window.scrollY : this.scroller.scrollTop;\n  }\n\n  onResize(e) {\n    this.resizeCanceler = true;\n  }\n\n  onTouchStart(e) {\n    let {\n      screenX,\n      screenY\n    } = e.touches[0];\n\n    if (this.fullsize) {\n      this.enableScroll();\n    }\n\n    this.touchCanceler = true;\n\n    if (!this.startTouchX) {\n      this.startTouchX = screenX;\n      this.startTouchY = screenY;\n      this.startTime = this.now();\n    }\n\n    this.endTouchX = screenX;\n    this.endTouchY = screenY;\n    this.endTime = this.now();\n  }\n\n  onTouchMove(e) {\n    let {\n      screenX,\n      screenY\n    } = e.touches[0];\n    let deltaY = Math.abs(screenY - this.endTouchY);\n    this.touchCanceler = true;\n\n    if (!this.fullsize && deltaY < 10) {\n      this.element.scrollLeft -= screenX - this.endTouchX;\n    }\n\n    this.endTouchX = screenX;\n    this.endTouchY = screenY;\n    this.endTime = this.now();\n  }\n\n  onTouchEnd(e) {\n    if (this.fullsize) {\n      this.disableScroll();\n    }\n\n    this.touchCanceler = false;\n    let swipped = this.wasSwiped();\n\n    if (swipped !== 0) {\n      this.snap(swipped);\n    } else {\n      this.snap();\n    }\n\n    this.startTouchX = undefined;\n    this.startTouchY = undefined;\n    this.startTime = undefined;\n    this.endTouchX = undefined;\n    this.endTouchY = undefined;\n    this.endTime = undefined;\n  }\n\n  wasSwiped() {\n    let snapWidth = this.layout.pageWidth * this.layout.divisor;\n    let distance = this.endTouchX - this.startTouchX;\n    let absolute = Math.abs(distance);\n    let time = this.endTime - this.startTime;\n    let velocity = distance / time;\n    let minVelocity = this.settings.minVelocity;\n\n    if (absolute <= this.settings.minDistance || absolute >= snapWidth) {\n      return 0;\n    }\n\n    if (velocity > minVelocity) {\n      // previous\n      return -1;\n    } else if (velocity < -minVelocity) {\n      // next\n      return 1;\n    }\n  }\n\n  needsSnap() {\n    let left = this.scrollLeft;\n    let snapWidth = this.layout.pageWidth * this.layout.divisor;\n    return left % snapWidth !== 0;\n  }\n\n  snap(howMany = 0) {\n    let left = this.scrollLeft;\n    let snapWidth = this.layout.pageWidth * this.layout.divisor;\n    let snapTo = Math.round(left / snapWidth) * snapWidth;\n\n    if (howMany) {\n      snapTo += howMany * snapWidth;\n    }\n\n    return this.smoothScrollTo(snapTo);\n  }\n\n  smoothScrollTo(destination) {\n    const deferred = new _core.defer();\n    const start = this.scrollLeft;\n    const startTime = this.now();\n    const duration = this.settings.duration;\n    const easing = this.settings.easing;\n    this.snapping = true; // add animation loop\n\n    function tick() {\n      const now = this.now();\n      const time = Math.min(1, (now - startTime) / duration);\n      const timeFunction = easing(time);\n\n      if (this.touchCanceler || this.resizeCanceler) {\n        this.resizeCanceler = false;\n        this.snapping = false;\n        deferred.resolve();\n        return;\n      }\n\n      if (time < 1) {\n        window.requestAnimationFrame(tick.bind(this));\n        this.scrollTo(start + (destination - start) * time, 0);\n      } else {\n        this.scrollTo(destination, 0);\n        this.snapping = false;\n        deferred.resolve();\n      }\n    }\n\n    tick.call(this);\n    return deferred.promise;\n  }\n\n  scrollTo(left = 0, top = 0) {\n    if (this.fullsize) {\n      window.scroll(left, top);\n    } else {\n      this.scroller.scrollLeft = left;\n      this.scroller.scrollTop = top;\n    }\n  }\n\n  now() {\n    return 'now' in window.performance ? performance.now() : new Date().getTime();\n  }\n\n  destroy() {\n    if (!this.scroller) {\n      return;\n    }\n\n    if (this.fullsize) {\n      this.enableScroll();\n    }\n\n    this.removeListeners();\n    this.scroller = undefined;\n  }\n\n}\n\n(0, _eventEmitter.default)(Snap.prototype);\nvar _default = Snap;\nexports.default = _default;"]},"metadata":{},"sourceType":"script"}